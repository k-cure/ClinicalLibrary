-- 11001 //유방암 환자수
WITH W1 AS (
SELECT HCODE AS HOSP_CD, PTNO AS PT_SBST_NO, SUBSTRING(FDX,1,4) AS CRIT_YR,  
CASE WHEN AGE<'20' THEN 10 --20세 미만
     WHEN AGE<'30' THEN 20  --20대
     WHEN AGE<'40' THEN 30  --30대
     WHEN AGE<'50' THEN 40  --40대 
     WHEN AGE<'60' THEN 50  --50대
     WHEN AGE<'70' THEN 60  --60대
     WHEN AGE<'80' THEN 70  --70대
     WHEN AGE>='80' THEN 80  --80대 이상 
   END AS PT_AGE,
SEX AS PT_SEX_CD, POPCODE AS STATS_TRGT_VL
FROM (SELECT DISTINCT HCODE, PTNO, MIN(AGE) AS AGE, SEX, MIN(FDX) AS FDX, POPCODE FROM CNCR_RGST WHERE POPCODE = '05' GROUP BY HCODE, PTNO,SEX, POPCODE) A -- '05' 유방암
WHERE FDX BETWEEN '20100101' AND '20211231'
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11001 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 환자수' AS SMRY_STATS_NM, 99010 AS TBL_ID, 9901002 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A 
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT 
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B 
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD;


-- 11002 //유방암 음주여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.CUR_DRNK_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CUR_DRNK_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11002 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 음주여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11003 //유방암 음주력여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DHIS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DHIS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11003 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 음주력여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11004 //유방암 음주시작연령별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_STRT_AGE_VL) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_STRT_AGE_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11004 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 음주시작연령별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11005 //유방암 음주종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_KNCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11005 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 음주종류별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11006 //유방암 음주량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_QTY) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_QTY,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11006 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 음주량별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11007 //유방암 음주횟수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_NT) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_NT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11007 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 음주횟수별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11008 //유방암 음주기간년수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_DTRN_YCNT) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_DTRN_YCNT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11008 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 음주기간년수별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11009 //유방암 금주시작년도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.NDRK_STRT_YR) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.NDRK_STRT_YR,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11009 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 금주시작년도별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11010 //유방암 흡연여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.CUR_SMOK_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CUR_SMOK_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11010 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 흡연여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11011 //유방암 흡연력여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.SHIS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SHIS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11011 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 흡연력여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11012 //유방암 흡연시작연령별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.SMOK_STRT_AGE_VL) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SMOK_STRT_AGE_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11012 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 흡연시작연령별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11013 //유방암 흡연량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.SMOK_QTY) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SMOK_QTY,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11013 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 흡연량별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101022 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11014 //유방암 흡연기간년수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.SMOK_DTRN_YCNT) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SMOK_DTRN_YCNT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11014 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 흡연기간년수별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11015 //유방암 금연시작년도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.NSMK_STRT_YR) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.NSMK_STRT_YR,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11015 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 금연시작년도별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101024 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11016 //유방암 병력여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11016 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101025 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11017 //유방암 병력고혈압여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_HTN_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_HTN_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11017 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력고혈압여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101027 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11018 //유방암 병력당뇨여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_DBT_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_DBT_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11018 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력당뇨여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101029 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11019 //유방암 병력결핵여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_TB_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_TB_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11019 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력결핵여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101031 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11020 //유방암 병력간질환여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_LVDS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_LVDS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11020 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력간질환여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101033 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11021 //유방암 병력고지혈증여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_HL_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_HL_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11021 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력고지혈증여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101035 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11022 //유방암 병력암여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_CNCR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_CNCR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11022 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력암여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101037 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11023 //유방암 병력암종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_CNCR_KNCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_CNCR_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11023 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력암종류별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101039 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11024 //유방암 병력우울증여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_DEPR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_DEPR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11024 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력우울증여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101041 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11025 //유방암 병력불면증여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_INSM_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_INSM_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11025 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력불면증여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101043 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11026 //유방암 병력심장질환여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_CADS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_CADS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11026 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병력심장질환여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101045 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11029 //유방암 주증상여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MAIN_SYM_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MAIN_SYM_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11029 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 주증상여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101050 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11030 //유방암 주증상내용별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MAIN_SYM_CONT) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MAIN_SYM_CONT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11030 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 주증상내용별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101052 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11031 //유방암 타병원진단후전원여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.OHAD_HSTR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OHAD_HSTR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11031 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 타병원진단후전원여부별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101053 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11032 //유방암 퇴원상태별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DSCH_STCD) as STATS_TRGT_CNT
from BRCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DSCH_STCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11032 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 퇴원상태별' AS SMRY_STATS_NM, 11010 AS TBL_ID, 1101055 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11033 //유방암 가족력여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHT_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHT_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11033 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 가족력여부별' AS SMRY_STATS_NM, 11020 AS TBL_ID, 1102005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11034 //유방암 환자가족관계별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.PT_FM_RLCD) as STATS_TRGT_CNT
from BRCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.PT_FM_RLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11034 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 환자가족관계별' AS SMRY_STATS_NM, 11020 AS TBL_ID, 1102007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11036 //유방암 가족병력고혈압여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHS_HTN_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHS_HTN_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11036 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 가족병력고혈압여부별' AS SMRY_STATS_NM, 11020 AS TBL_ID, 1102010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11037 //유방암 가족병력당뇨여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHS_DBT_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHS_DBT_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11037 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 가족병력당뇨여부별' AS SMRY_STATS_NM, 11020 AS TBL_ID, 1102012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11038 //유방암 가족력결핵여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHT_TB_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHT_TB_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11038 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 가족력결핵여부별' AS SMRY_STATS_NM, 11020 AS TBL_ID, 1102014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11039 //유방암 가족병력간질환여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHS_LVDS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHS_LVDS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11039 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 가족병력간질환여부별' AS SMRY_STATS_NM, 11020 AS TBL_ID, 1102016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11040 //유방암 가족병력암여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHS_CNCR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHS_CNCR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11040 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 가족병력암여부별' AS SMRY_STATS_NM, 11020 AS TBL_ID, 1102018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11041 //유방암 가족력암종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHT_CNCR_KNCD) as STATS_TRGT_CNT
from BRCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHT_CNCR_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11041 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 가족력암종류별' AS SMRY_STATS_NM, 11020 AS TBL_ID, 1102020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11045 //유방암 결혼여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.MARG_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MARG_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11045 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 결혼여부별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11046 //유방암 HRT경험여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.HRPR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HRPR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11046 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 HRT경험여부별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11047 //유방암 HRT시행월수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.HRT_IMPL_MCNT) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.HRT_IMPL_MCNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11047 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 HRT시행월수별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11048 //유방암 초경연령별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.MENA_AGE_VL) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.MENA_AGE_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11048 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 초경연령별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11049 //유방암 출산연령별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.DELV_AGE_VL) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.DELV_AGE_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11049 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 출산연령별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11050 //유방암 출산자녀수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.DELV_CHLD_CNT) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.DELV_CHLD_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11050 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 출산자녀수별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11051 //유방암 모유수유경험여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.BFPR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BFPR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11051 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 모유수유경험여부별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11052 //유방암 모유수유월수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.BRFD_MCNT) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BRFD_MCNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11052 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 모유수유월수별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11053 //유방암 경구피임약사용여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.OC_USE_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OC_USE_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11053 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 경구피임약사용여부별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11054 //유방암 경구피임약사용월수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.OC_USE_MCNT) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.OC_USE_MCNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11054 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 경구피임약사용월수별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11055 //유방암 폐경여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.MENO_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MENO_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11055 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 폐경여부별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11056 //유방암 폐경연령별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.MENO_AGE_VL) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.MENO_AGE_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11056 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 폐경연령별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11057 //유방암 자궁적출술여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, SUBSTRING(A.OBTR_RCRD_YMD,1,4) AS CRIT_YR, count(A.UTEC_YN_NOANS_SPCD) as STATS_TRGT_CNT
from BRCN_PT_OBINF A 
where  A.OBTR_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OBTR_RCRD_YMD,1,4),  A.OBTR_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OBTR_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OBTR_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.UTEC_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_PT_OBINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11057 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 자궁적출술여부별' AS SMRY_STATS_NM, 11030 AS TBL_ID, 1103024 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11058 //유방암 신장측정별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.HT_MSRM_VL) as STATS_TRGT_CNT
from BRCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.HT_MSRM_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11058 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 신장측정별' AS SMRY_STATS_NM, 11040 AS TBL_ID, 1104005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11059 //유방암 체중측정별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.WT_MSRM_VL) as STATS_TRGT_CNT
from BRCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.WT_MSRM_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11059 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 체중측정별' AS SMRY_STATS_NM, 11040 AS TBL_ID, 1104006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11060 //유방암 BMI별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.BMI_VL) as STATS_TRGT_CNT
from BRCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BMI_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11060 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 BMI별' AS SMRY_STATS_NM, 11040 AS TBL_ID, 1104007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11061 //유방암 이완혈압별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.RLXT_BLPR_VL) as STATS_TRGT_CNT
from BRCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RLXT_BLPR_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11061 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 이완혈압별' AS SMRY_STATS_NM, 11040 AS TBL_ID, 1104008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11062 //유방암 수축혈압별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.CTRT_BLPR_VL) as STATS_TRGT_CNT
from BRCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CTRT_BLPR_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11062 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수축혈압별' AS SMRY_STATS_NM, 11040 AS TBL_ID, 1104009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11063 //유방암 ECOG코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.ECOG_CD) as STATS_TRGT_CNT
from BRCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ECOG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11063 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 ECOG코드별' AS SMRY_STATS_NM, 11040 AS TBL_ID, 1104010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11064 //유방암 유방암진단종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, SUBSTRING(A.DIAG_RGST_YMD,1,4) AS CRIT_YR, count(A.BRCN_DIAG_KNCD) as STATS_TRGT_CNT
from BRCN_DIAG_INF A 
where  A.DIAG_RGST_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_RGST_YMD,1,4),  A.DIAG_RGST_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BRCN_DIAG_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_INF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11064 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 유방암진단종류별' AS SMRY_STATS_NM, 11050 AS TBL_ID, 1105005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11065 //유방암 진단KCD코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, SUBSTRING(A.DIAG_RGST_YMD,1,4) AS CRIT_YR, count(A.DIAG_KCD_CD) as STATS_TRGT_CNT
from BRCN_DIAG_INF A 
where  A.DIAG_RGST_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_RGST_YMD,1,4),  A.DIAG_RGST_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DIAG_KCD_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_INF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11065 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단KCD코드별' AS SMRY_STATS_NM, 11050 AS TBL_ID, 1105009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11066 //유방암 진단KCD명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, SUBSTRING(A.DIAG_RGST_YMD,1,4) AS CRIT_YR, count(A.DIAG_KCD_NM) as STATS_TRGT_CNT
from BRCN_DIAG_INF A 
where  A.DIAG_RGST_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_RGST_YMD,1,4),  A.DIAG_RGST_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DIAG_KCD_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_INF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11066 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단KCD명별' AS SMRY_STATS_NM, 11050 AS TBL_ID, 1105010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11067 //유방암 진단SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, SUBSTRING(A.DIAG_RGST_YMD,1,4) AS CRIT_YR, count(A.DIAG_SMCT_CD) as STATS_TRGT_CNT
from BRCN_DIAG_INF A 
where  A.DIAG_RGST_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_RGST_YMD,1,4),  A.DIAG_RGST_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DIAG_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_INF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11067 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단SNOMEDCT코드별' AS SMRY_STATS_NM, 11050 AS TBL_ID, 1105011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11068 //유방암 진단SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, SUBSTRING(A.DIAG_RGST_YMD,1,4) AS CRIT_YR, count(A.DIAG_SMCT_NM) as STATS_TRGT_CNT
from BRCN_DIAG_INF A 
where  A.DIAG_RGST_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_RGST_YMD,1,4),  A.DIAG_RGST_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DIAG_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_INF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11068 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단SNOMEDCT명별' AS SMRY_STATS_NM, 11050 AS TBL_ID, 1105012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11069 //유방암 전이부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, SUBSTRING(A.MTDG_YMD,1,4) AS CRIT_YR, count(A.MTST_SITE_CD) as STATS_TRGT_CNT
from BRCN_DIAG_MTST A 
where  A.MTDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MTDG_YMD,1,4),  A.MTDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MTST_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_MTST B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11069 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 전이부위별' AS SMRY_STATS_NM, 11060 AS TBL_ID, 1106005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11070 //유방암 전이양상별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, SUBSTRING(A.MTDG_YMD,1,4) AS CRIT_YR, count(A.MTST_ASPT_CD) as STATS_TRGT_CNT
from BRCN_DIAG_MTST A 
where  A.MTDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MTDG_YMD,1,4),  A.MTDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MTST_ASPT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_MTST B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11070 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 전이양상별' AS SMRY_STATS_NM, 11060 AS TBL_ID, 1106007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11071 //유방암 전이진단방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, SUBSTRING(A.MTDG_YMD,1,4) AS CRIT_YR, count(A.MTDG_MTCD) as STATS_TRGT_CNT
from BRCN_DIAG_MTST A 
where  A.MTDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MTDG_YMD,1,4),  A.MTDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MTDG_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_MTST B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11071 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 전이진단방법별' AS SMRY_STATS_NM, 11060 AS TBL_ID, 1106009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11072 //유방암 임상종양특성별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_TUMR_PRTY_CD) as STATS_TRGT_CNT
from BRCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_TUMR_PRTY_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11072 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 임상종양특성별' AS SMRY_STATS_NM, 11070 AS TBL_ID, 1107005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11073 //유방암 AJCC년도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.AJCC_YR) as STATS_TRGT_CNT
from BRCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AJCC_YR,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11073 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 AJCC년도별' AS SMRY_STATS_NM, 11070 AS TBL_ID, 1107007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11074 //유방암 임상TNM병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_TNM_STAG_VL) as STATS_TRGT_CNT
from BRCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_TNM_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11074 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 임상TNM병기별' AS SMRY_STATS_NM, 11070 AS TBL_ID, 1107008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11075 //유방암 임상T병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_T_STAG_VL) as STATS_TRGT_CNT
from BRCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_T_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11075 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 임상T병기별' AS SMRY_STATS_NM, 11070 AS TBL_ID, 1107009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11076 //유방암 임상N병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_N_STAG_VL) as STATS_TRGT_CNT
from BRCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_N_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11076 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 임상N병기별' AS SMRY_STATS_NM, 11070 AS TBL_ID, 1107010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11077 //유방암 임상M병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_M_STAG_VL) as STATS_TRGT_CNT
from BRCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_M_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11077 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 임상M병기별' AS SMRY_STATS_NM, 11070 AS TBL_ID, 1107011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11078 //유방암 진단검사종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_KNCD) as STATS_TRGT_CNT
from BRCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11078 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단검사종류별' AS SMRY_STATS_NM, 11080 AS TBL_ID, 1108005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11079 //유방암 진단검사EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_EDI_CD) as STATS_TRGT_CNT
from BRCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11079 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단검사EDI코드별' AS SMRY_STATS_NM, 11080 AS TBL_ID, 1108009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11080 //유방암 진단검사EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_EDI_NM) as STATS_TRGT_CNT
from BRCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11080 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단검사EDI명별' AS SMRY_STATS_NM, 11080 AS TBL_ID, 1108010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11081 //유방암 진단검사SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_SMCT_CD) as STATS_TRGT_CNT
from BRCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11081 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단검사SNOMEDCT코드별' AS SMRY_STATS_NM, 11080 AS TBL_ID, 1108011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11082 //유방암 진단검사SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_SMCT_NM) as STATS_TRGT_CNT
from BRCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11082 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단검사SNOMEDCT명별' AS SMRY_STATS_NM, 11080 AS TBL_ID, 1108012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11083 //유방암 진단검사LOINC코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_LOINC_CD) as STATS_TRGT_CNT
from BRCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_LOINC_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11083 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단검사LOINC코드별' AS SMRY_STATS_NM, 11080 AS TBL_ID, 1108013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11084 //유방암 진단검사LOINC명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_LOINC_NM) as STATS_TRGT_CNT
from BRCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_LOINC_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11084 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 진단검사LOINC명별' AS SMRY_STATS_NM, 11080 AS TBL_ID, 1108014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11085 //유방암 영상검사종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_KNCD) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11085 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 영상검사종류별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11086 //유방암 영상검사EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_EDI_CD) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11086 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 영상검사EDI코드별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11087 //유방암 영상검사EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_EDI_NM) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11087 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 영상검사EDI명별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11088 //유방암 영상검사SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_SMCT_CD) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11088 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 영상검사SNOMEDCT코드별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11089 //유방암 영상검사SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_SMCT_NM) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11089 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 영상검사SNOMEDCT명별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11090 //유방암 유방밀도분류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.BRST_DENS_CLCD) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BRST_DENS_CLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11090 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 유방밀도분류별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11091 //유방암 영상검사결과진단분류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_RSLT_DIAG_CLCD) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_RSLT_DIAG_CLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11091 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 영상검사결과진단분류별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11092 //유방암 미세석회화여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.MICF_YN_UNID_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MICF_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11092 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 미세석회화여부확인불가구분별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11093 //유방암 비대칭여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.ASYT_YN_UNID_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ASYT_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11093 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 비대칭여부확인불가구분별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11094 //유방암 전신전이여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.BOMS_YN_UNID_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BOMS_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11094 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 전신전이여부확인불가구분별' AS SMRY_STATS_NM, 11090 AS TBL_ID, 1109022 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11095 //유방암 생체검사부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.BPSY_SITE_CD) as STATS_TRGT_CNT
from BRCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BPSY_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11095 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 생체검사부위별' AS SMRY_STATS_NM, 11100 AS TBL_ID, 1110006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11096 //유방암 생체검사부위편측성별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.BPSY_SITE_LATR_CD) as STATS_TRGT_CNT
from BRCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BPSY_SITE_LATR_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11096 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 생체검사부위편측성별' AS SMRY_STATS_NM, 11100 AS TBL_ID, 1110008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11097 //유방암 생체검사방법종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.BPSY_MTHD_KNCD) as STATS_TRGT_CNT
from BRCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BPSY_MTHD_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11097 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 생체검사방법종류별' AS SMRY_STATS_NM, 11100 AS TBL_ID, 1110012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11098 //유방암 조직학적진단별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.HTLG_DIAG_CD) as STATS_TRGT_CNT
from BRCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HTLG_DIAG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11098 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 조직학적진단별' AS SMRY_STATS_NM, 11100 AS TBL_ID, 1110015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11099 //유방암 조직학적등급별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.HTLG_GRCD) as STATS_TRGT_CNT
from BRCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HTLG_GRCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11099 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 조직학적등급별' AS SMRY_STATS_NM, 11100 AS TBL_ID, 1110017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11100 //유방암 면역병리검사종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, SUBSTRING(A.IMEM_YMD,1,4) AS CRIT_YR, count(A.IMEM_KNCD) as STATS_TRGT_CNT
from BRCN_EXAM_IMPT A 
where  A.IMEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEM_YMD,1,4),  A.IMEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEM_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11100 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 면역병리검사종류별' AS SMRY_STATS_NM, 11110 AS TBL_ID, 1111006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11101 //유방암 면역병리검사소견분류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, SUBSTRING(A.IMEM_YMD,1,4) AS CRIT_YR, count(A.IMEM_OPN_CLCD) as STATS_TRGT_CNT
from BRCN_EXAM_IMPT A 
where  A.IMEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEM_YMD,1,4),  A.IMEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEM_OPN_CLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_IMPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11101 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 면역병리검사소견분류별' AS SMRY_STATS_NM, 11110 AS TBL_ID, 1111010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11102 //유방암 분자병리검사종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, SUBSTRING(A.MLEM_YMD,1,4) AS CRIT_YR, count(A.MLEM_KNCD) as STATS_TRGT_CNT
from BRCN_EXAM_MLPT A 
where  A.MLEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MLEM_YMD,1,4),  A.MLEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MLEM_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_MLPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11102 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 분자병리검사종류별' AS SMRY_STATS_NM, 11120 AS TBL_ID, 1112008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11103 //유방암 분자병리검사방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, SUBSTRING(A.MLEM_YMD,1,4) AS CRIT_YR, count(A.MLEM_MTCD) as STATS_TRGT_CNT
from BRCN_EXAM_MLPT A 
where  A.MLEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MLEM_YMD,1,4),  A.MLEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MLEM_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_MLPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11103 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 분자병리검사방법별' AS SMRY_STATS_NM, 11120 AS TBL_ID, 1112010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11104 //유방암 분자병리검사결과별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, SUBSTRING(A.MLEM_YMD,1,4) AS CRIT_YR, count(A.MLEM_RSLT_CD) as STATS_TRGT_CNT
from BRCN_EXAM_MLPT A 
where  A.MLEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MLEM_YMD,1,4),  A.MLEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MLEM_RSLT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_MLPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11104 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 분자병리검사결과별' AS SMRY_STATS_NM, 11120 AS TBL_ID, 1112012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11105 //유방암 분자병리검사결과종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, SUBSTRING(A.MLEM_YMD,1,4) AS CRIT_YR, count(A.MLEM_RSLT_KNCD) as STATS_TRGT_CNT
from BRCN_EXAM_MLPT A 
where  A.MLEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MLEM_YMD,1,4),  A.MLEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MLEM_RSLT_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_MLPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11105 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 분자병리검사결과종류별' AS SMRY_STATS_NM, 11120 AS TBL_ID, 1112014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11106 //유방암 생식세포변이검사방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.GMVX_MTCD) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.GMVX_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11106 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 생식세포변이검사방법별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11107 //유방암 생식세포변이검사유전자종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.GMVX_GENE_KNCD) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.GMVX_GENE_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11107 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 생식세포변이검사유전자종류별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11108 //유방암 병원변형체감지여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.PAVR_DETECT_YN_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.PAVR_DETECT_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11108 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 병원변형체감지여부별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11109 //유방암 미확인변형체감지여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.UNCL_VARNT_DETECT_YN_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.UNCL_VARNT_DETECT_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11109 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 미확인변형체감지여부별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11110 //유방암 DNA변이정보A별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.DNA_VAINF_A_VL) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DNA_VAINF_A_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11110 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 DNA변이정보A별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11111 //유방암 DNA변이정보B별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.DNA_VAINF_B_CD) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DNA_VAINF_B_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11111 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 DNA변이정보B별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11112 //유방암 DNA변이정보C별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.DNA_VAINF_C_CD) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DNA_VAINF_C_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11112 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 DNA변이정보C별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11113 //유방암 아미노산변이정보A별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.AMSN_VAINF_A_CD) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AMSN_VAINF_A_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11113 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 아미노산변이정보A별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11114 //유방암 아미노산변이정보B별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.AMSN_VAINF_B_VL) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.AMSN_VAINF_B_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11114 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 아미노산변이정보B별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11115 //유방암 아미노산변이정보C별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, SUBSTRING(A.GMVX_YMD,1,4) AS CRIT_YR, count(A.AMSN_VAINF_C_CD) as STATS_TRGT_CNT
from BRCN_EXAM_GMVX A 
where  A.GMVX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GMVX_YMD,1,4),  A.GMVX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GMVX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GMVX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AMSN_VAINF_C_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GMVX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11115 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 아미노산변이정보C별' AS SMRY_STATS_NM, 11130 AS TBL_ID, 1113024 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11116 //유방암 유전자발현검사종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GNRX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GNRX_YMD, SUBSTRING(A.GNRX_YMD,1,4) AS CRIT_YR, count(A.GNRX_KNCD) as STATS_TRGT_CNT
from BRCN_EXAM_GNRX A 
where  A.GNRX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GNRX_YMD,1,4),  A.GNRX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GNRX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.GNRX_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GNRX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11116 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 유전자발현검사종류별' AS SMRY_STATS_NM, 11140 AS TBL_ID, 1114005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11117 //유방암 유전자발현검사결과종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.GNRX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.GNRX_YMD, SUBSTRING(A.GNRX_YMD,1,4) AS CRIT_YR, count(A.GNRX_RSLT_KNCD) as STATS_TRGT_CNT
from BRCN_EXAM_GNRX A 
where  A.GNRX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.GNRX_YMD,1,4),  A.GNRX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.GNRX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.GNRX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.GNRX_RSLT_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_GNRX B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11117 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 유전자발현검사결과종류별' AS SMRY_STATS_NM, 11140 AS TBL_ID, 1114007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11118 //유방암 수술종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_KNCD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11118 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술종류별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11119 //유방암 수술EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_EDI_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11119 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술EDI코드별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11120 //유방암 수술EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_EDI_NM) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11120 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술EDI명별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11121 //유방암 수술SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_SMCT_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11121 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술SNOMEDCT코드별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11122 //유방암 수술SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_SMCT_NM) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11122 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술SNOMEDCT명별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11123 //유방암 수술ICD9CM코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_ICD9CM_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_ICD9CM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11123 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술ICD9CM코드별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11124 //유방암 수술ICD9CM명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_ICD9CM_NM) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_ICD9CM_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11124 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술ICD9CM명별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11125 //유방암 수술마취부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_ANST_SITE_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_ANST_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11125 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술마취부위별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11126 //유방암 추정실혈량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.EBL_QTY) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.EBL_QTY),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11126 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 추정실혈량별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11127 //유방암 수술목적별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_PRPS_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_PRPS_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11127 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술목적별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11128 //유방암 수술부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_SITE_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11128 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술부위별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11129 //유방암 유방암수술방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.BRCN_OPRT_MTCD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BRCN_OPRT_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11129 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 유방암수술방법별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11130 //유방암 ASA점수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.ASA_SCOR_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ASA_SCOR_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11130 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 ASA점수별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115025 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11131 //유방암 수술절개선유형별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_ICLN_TPCD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_ICLN_TPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11131 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술절개선유형별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115028 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11132 //유방암 수술종양위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_TUMR_LOCA_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_TUMR_LOCA_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11132 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술종양위치별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115030 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11133 //유방암 수술종양상세위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_TUMR_DETL_LOCA_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_TUMR_DETL_LOCA_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11133 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술종양상세위치별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115032 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11134 //유방암 재건술분류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.REPR_CLCD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.REPR_CLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11134 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 재건술분류별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115034 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11135 //유방암 재건술방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.REPR_MTCD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.REPR_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11135 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 재건술방법별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115036 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11136 //유방암 감시림프절검출방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.SLND_DTCT_MTCD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SLND_DTCT_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11136 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 감시림프절검출방법별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115038 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11137 //유방암 수술후평가항목별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.AFOP_ASMT_ITEM_CD) as STATS_TRGT_CNT
from BRCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_ASMT_ITEM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11137 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술후평가항목별' AS SMRY_STATS_NM, 11150 AS TBL_ID, 1115040 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11138 //유방암 혈액제제종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, SUBSTRING(A.BLTR_PRSC_YMD,1,4) AS CRIT_YR, count(A.BLPT_KNCD) as STATS_TRGT_CNT
from BRCN_TRTM_BLTR A 
where  A.BLTR_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BLTR_PRSC_YMD,1,4),  A.BLTR_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BLPT_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_BLTR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11138 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 혈액제제종류별' AS SMRY_STATS_NM, 11160 AS TBL_ID, 1116005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11139 //유방암 혈액제제용량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, SUBSTRING(A.BLTR_PRSC_YMD,1,4) AS CRIT_YR, count(A.BLPT_CAPA) as STATS_TRGT_CNT
from BRCN_TRTM_BLTR A 
where  A.BLTR_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BLTR_PRSC_YMD,1,4),  A.BLTR_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BLPT_CAPA),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_TRTM_BLTR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11139 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 혈액제제용량별' AS SMRY_STATS_NM, 11160 AS TBL_ID, 1116009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11140 //유방암 수혈팩수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, SUBSTRING(A.BLTR_PRSC_YMD,1,4) AS CRIT_YR, count(A.BLTR_PACK_CNT) as STATS_TRGT_CNT
from BRCN_TRTM_BLTR A 
where  A.BLTR_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BLTR_PRSC_YMD,1,4),  A.BLTR_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BLTR_PACK_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_TRTM_BLTR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11140 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수혈팩수별' AS SMRY_STATS_NM, 11160 AS TBL_ID, 1116010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11141 //유방암 수혈총량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, SUBSTRING(A.BLTR_PRSC_YMD,1,4) AS CRIT_YR, count(A.BLTR_TOTL_QTY) as STATS_TRGT_CNT
from BRCN_TRTM_BLTR A 
where  A.BLTR_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BLTR_PRSC_YMD,1,4),  A.BLTR_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BLTR_TOTL_QTY),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_TRTM_BLTR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11141 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수혈총량별' AS SMRY_STATS_NM, 11160 AS TBL_ID, 1116011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11142 //유방암 외과병리채취부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.SGPT_HVST_SITE_CD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SGPT_HVST_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11142 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 외과병리채취부위별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11143 //유방암 외과병리검사부위편측성별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.SGPT_EXAM_SITE_LATR_CD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SGPT_EXAM_SITE_LATR_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11143 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 외과병리검사부위편측성별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11144 //유방암 외과병리검사결과종양수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.SRGC_PTEM_RSLT_TUMR_CNT) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.SRGC_PTEM_RSLT_TUMR_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11144 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 외과병리검사결과종양수별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11145 //유방암 종양가로길이별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.TUMR_WDTH_LNTH_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.TUMR_WDTH_LNTH_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11145 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 종양가로길이별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11146 //유방암 종양세로길이별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.TUMR_LGTD_LNTH_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.TUMR_LGTD_LNTH_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11146 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 종양세로길이별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11147 //유방암 종양높이별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.TUMR_HGHT_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.TUMR_HGHT_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11147 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 종양높이별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11148 //유방암 종양최대직경별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.TUMR_MAX_DIAM_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.TUMR_MAX_DIAM_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11148 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 종양최대직경별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11149 //유방암 조직학적진단별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.HTLG_DIAG_CD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HTLG_DIAG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11149 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 조직학적진단별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11150 //유방암 조직학적등급별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.HTLG_GRCD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HTLG_GRCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11150 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 조직학적등급별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11151 //유방암 림프혈관침윤존재여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.LVIN_EX_YN_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.LVIN_EX_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11151 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 림프혈관침윤존재여부별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11152 //유방암 림프절주위침윤존재여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.LPIN_EX_YN_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.LPIN_EX_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11152 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 림프절주위침윤존재여부별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11153 //유방암 유두침윤존재여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.NIIN_EX_YN_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.NIIN_EX_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11153 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 유두침윤존재여부별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11154 //유방암 외과병리미세석회화존재여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.SGPT_MICF_EX_YN_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SGPT_MICF_EX_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11154 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 외과병리미세석회화존재여부별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117025 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11155 //유방암 상피내암괴사존재여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.INCN_NECR_EX_YN_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.INCN_NECR_EX_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11155 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 상피내암괴사존재여부별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117027 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11156 //유방암 상피내암동반존재여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.INCN_ASSO_EX_YN_SPCD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.INCN_ASSO_EX_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11156 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 상피내암동반존재여부별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117029 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11157 //유방암 상피내암핵등급별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.INCN_CORE_GRCD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.INCN_CORE_GRCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11157 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 상피내암핵등급별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117031 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11158 //유방암 수술절제면안전경계길이별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.SRMG_SFMG_LNTH_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.SRMG_SFMG_LNTH_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11158 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술절제면안전경계길이별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117033 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11159 //유방암 수술절제면잔존별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.SRMG_RLCT_CD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SRMG_RLCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11159 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술절제면잔존별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117035 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11160 //유방암 전이암크기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.MTCR_SIZE_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.MTCR_SIZE_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11160 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 전이암크기별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117037 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11161 //유방암 동반병변별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.ASSO_LESN_CD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ASSO_LESN_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11161 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 동반병변별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117038 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11162 //유방암 잔여종양별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.RESI_TUMR_CD) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RESI_TUMR_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11162 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 잔여종양별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117040 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11163 //유방암 림프절총수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.LN_TOTL_CNT) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.LN_TOTL_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11163 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 림프절총수별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117042 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11164 //유방암 양성림프절수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.PSTV_LN_CNT) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.PSTV_LN_CNT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11164 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 양성림프절수별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117043 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11165 //유방암 감시림프절총수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.SLND_TOTL_CNT) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.SLND_TOTL_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11165 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 감시림프절총수별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117044 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11166 //유방암 양성감시림프절수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.PSTV_SLND_CNT) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.PSTV_SLND_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11166 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 양성감시림프절수별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117045 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11167 //유방암 비감시림프절총수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.NSND_TOTL_CNT) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.NSND_TOTL_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11167 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 비감시림프절총수별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117046 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11168 //유방암 양성비감시림프절수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.PSTV_NSND_CNT) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.PSTV_NSND_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11168 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 양성비감시림프절수별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117047 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11169 //유방암 AJCC년도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AJCC_YR) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AJCC_YR,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11169 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 AJCC년도별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117048 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11170 //유방암 수술후병리TNM병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_PATH_TNM_STAG_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_PATH_TNM_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11170 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술후병리TNM병기별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117049 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11171 //유방암 수술후병리T병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_PATH_T_STAG_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_PATH_T_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11171 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술후병리T병기별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117050 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11172 //유방암 수술후병리N병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_PATH_N_STAG_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_PATH_N_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11172 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술후병리N병기별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117051 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11173 //유방암 수술후병리M병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_PATH_M_STAG_VL) as STATS_TRGT_CNT
from BRCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_PATH_M_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11173 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술후병리M병기별' AS SMRY_STATS_NM, 11170 AS TBL_ID, 1117052 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11174 //유방암 수술후합병증내용별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, SUBSTRING(A.COMP_OCRN_OPRT_YMD,1,4) AS CRIT_YR, count(A.AFOC_CONT) as STATS_TRGT_CNT
from BRCN_DIAG_AFOC A 
where  A.COMP_OCRN_OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.COMP_OCRN_OPRT_YMD,1,4),  A.COMP_OCRN_OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOC_CONT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_AFOC B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11174 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 수술후합병증내용별' AS SMRY_STATS_NM, 11180 AS TBL_ID, 1118006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11175 //유방암 합병증등급별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, SUBSTRING(A.COMP_OCRN_OPRT_YMD,1,4) AS CRIT_YR, count(A.COMP_GRCD) as STATS_TRGT_CNT
from BRCN_DIAG_AFOC A 
where  A.COMP_OCRN_OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.COMP_OCRN_OPRT_YMD,1,4),  A.COMP_OCRN_OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.COMP_GRCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_DIAG_AFOC B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11175 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 합병증등급별' AS SMRY_STATS_NM, 11180 AS TBL_ID, 1118007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11176 //유방암 약제분류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_CLCD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_CLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11176 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제분류별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11177 //유방암 항암약제구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.ANDR_SPCD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANDR_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11177 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 항암약제구분별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11178 //유방암 약제성분종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_KNCD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11178 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제성분종류별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11179 //유방암 약제성분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_CD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11179 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제성분별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11180 //유방암 약제성분명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_NM) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11180 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제성분명별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11181 //유방암 약제성분SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_SMCT_CD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11181 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제성분SNOMEDCT코드별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11182 //유방암 약제성분SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_SMCT_NM) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11182 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제성분SNOMEDCT명별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11183 //유방암 약제EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_EDI_CD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11183 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제EDI코드별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11184 //유방암 약제EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_EDI_NM) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11184 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제EDI명별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11185 //유방암 약제ATC코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_ATC_CD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_ATC_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11185 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제ATC코드별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11186 //유방암 약제ATC명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_ATC_NM) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_ATC_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11186 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제ATC명별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11187 //유방암 약제RXNORM코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_RXNM_CD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_RXNM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11187 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제RXNORM코드별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11188 //유방암 약제RXNORM명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_RXNM_NM) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_RXNM_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11188 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제RXNORM명별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119022 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11189 //유방암 약제처방용량단위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_PRSC_CAPA_UNIT_CD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_PRSC_CAPA_UNIT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11189 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제처방용량단위별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119024 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11190 //유방암 약제투여경로별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_INJC_PTH_CD) as STATS_TRGT_CNT
from BRCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_INJC_PTH_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11190 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 약제투여경로별' AS SMRY_STATS_NM, 11190 AS TBL_ID, 1119027 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11191 //유방암 항암요법주기수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_CYCL_CNT) as STATS_TRGT_CNT
from BRCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.ANTP_CYCL_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11191 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 항암요법주기수별' AS SMRY_STATS_NM, 11200 AS TBL_ID, 1120007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11192 //유방암 항암요법라인수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_LINE_CNT) as STATS_TRGT_CNT
from BRCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.ANTP_LINE_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11192 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 항암요법라인수별' AS SMRY_STATS_NM, 11200 AS TBL_ID, 1120008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11193 //유방암 항암요법임시중단여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_TEMP_STOP_YN_UNID_SPCD) as STATS_TRGT_CNT
from BRCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_TEMP_STOP_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11193 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 항암요법임시중단여부확인불가구분별' AS SMRY_STATS_NM, 11200 AS TBL_ID, 1120009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11194 //유방암 항암요법종료이유별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_END_RESN_CD) as STATS_TRGT_CNT
from BRCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_END_RESN_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11194 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 항암요법종료이유별' AS SMRY_STATS_NM, 11200 AS TBL_ID, 1120011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11195 //유방암 항암요법평가항목별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_ASMT_ITEM_CD) as STATS_TRGT_CNT
from BRCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_ASMT_ITEM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11195 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 항암요법평가항목별' AS SMRY_STATS_NM, 11200 AS TBL_ID, 1120014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11196 //유방암 항암요법부작용항목별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_SEFF_ITEM_CD) as STATS_TRGT_CNT
from BRCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_SEFF_ITEM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11196 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 항암요법부작용항목별' AS SMRY_STATS_NM, 11200 AS TBL_ID, 1120016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11197 //유방암 항암요법부작용등급별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_SEFF_GRCD) as STATS_TRGT_CNT
from BRCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_SEFF_GRCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11197 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 항암요법부작용등급별' AS SMRY_STATS_NM, 11200 AS TBL_ID, 1120018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11198 //유방암 항암요법치료목적별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_TRTM_PRPS_CD) as STATS_TRGT_CNT
from BRCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_TRTM_PRPS_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11198 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 항암요법치료목적별' AS SMRY_STATS_NM, 11200 AS TBL_ID, 1120020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11199 //유방암 방사선치료종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_KNCD) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11199 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료종류별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11200 //유방암 방사선치료EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_EDI_CD) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11200 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료EDI코드별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11201 //유방암 방사선치료EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_EDI_NM) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11201 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료EDI명별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11202 //유방암 방사선치료SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SMCT_CD) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11202 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료SNOMEDCT코드별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11203 //유방암 방사선치료SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SMCT_NM) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11203 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료SNOMEDCT명별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11204 //유방암 방사선치료목적별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_PRPS_CD) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_PRPS_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11204 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료목적별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11205 //유방암 방사선치료부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SITE_CD) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11205 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료부위별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11206 //유방암 방사선선량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RD_GY) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.RD_GY),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11206 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선선량별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11207 //유방암 방사선시행횟수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RD_IMPL_NT) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.RD_IMPL_NT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11207 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선시행횟수별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11208 //유방암 방사선총선량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RD_TOTL_GY) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.RD_TOTL_GY),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11208 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선총선량별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11209 //유방암 방사선치료부작용시기구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SEFF_PERD_SPCD) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SEFF_PERD_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11209 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료부작용시기구분별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11210 //유방암 방사선치료부작용종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SEFF_KNCD) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SEFF_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11210 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료부작용종류별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11211 //유방암 방사선치료부작용등급별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SEFF_GRCD) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SEFF_GRCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11211 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료부작용등급별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121025 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11212 //유방암 방사선치료평가항목별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_ASMT_ITEM_CD) as STATS_TRGT_CNT
from BRCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_ASMT_ITEM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11212 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 방사선치료평가항목별' AS SMRY_STATS_NM, 11210 AS TBL_ID, 1121027 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11213 //유방암 재발부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, SUBSTRING(A.RLDG_YMD,1,4) AS CRIT_YR, count(A.RLPS_SITE_CD) as STATS_TRGT_CNT
from BRCN_FUOR_RLPS A 
where  A.RLDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RLDG_YMD,1,4),  A.RLDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RLPS_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_FUOR_RLPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11213 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 재발부위별' AS SMRY_STATS_NM, 11220 AS TBL_ID, 1122005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11214 //유방암 재발진단방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, SUBSTRING(A.RLDG_YMD,1,4) AS CRIT_YR, count(A.RLDG_MTCD) as STATS_TRGT_CNT
from BRCN_FUOR_RLPS A 
where  A.RLDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RLDG_YMD,1,4),  A.RLDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RLDG_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_FUOR_RLPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11214 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 재발진단방법별' AS SMRY_STATS_NM, 11220 AS TBL_ID, 1122008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11215 //유방암 재발종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, SUBSTRING(A.RLDG_YMD,1,4) AS CRIT_YR, count(A.RLPS_KNCD) as STATS_TRGT_CNT
from BRCN_FUOR_RLPS A 
where  A.RLDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RLDG_YMD,1,4),  A.RLDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RLPS_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_FUOR_RLPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11215 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 재발종류별' AS SMRY_STATS_NM, 11220 AS TBL_ID, 1122010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 11216 //유방암 재발증상별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, SUBSTRING(A.RLDG_YMD,1,4) AS CRIT_YR, count(A.RLPS_SYM_CD) as STATS_TRGT_CNT
from BRCN_FUOR_RLPS A 
where  A.RLDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RLDG_YMD,1,4),  A.RLDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE =  '05' ) B -- '05' 유방암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RLPS_SYM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN BRCN_FUOR_RLPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 11216 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '유방암 재발증상별' AS SMRY_STATS_NM, 11220 AS TBL_ID, 1122012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


