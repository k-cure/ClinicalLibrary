-- 10001 //위암 환자수
WITH W1 AS (
SELECT HCODE AS HOSP_CD, PTNO AS PT_SBST_NO, SUBSTRING(FDX,1,4) AS CRIT_YR,  
CASE WHEN AGE<'20' THEN 10 --20세 미만
     WHEN AGE<'30' THEN 20  --20대
     WHEN AGE<'40' THEN 30  --30대
     WHEN AGE<'50' THEN 40  --40대 
     WHEN AGE<'60' THEN 50  --50대
     WHEN AGE<'70' THEN 60  --60대
     WHEN AGE<'80' THEN 70  --70대
     WHEN AGE>='80' THEN 80  --80대 이상 
   END AS PT_AGE,
SEX AS PT_SEX_CD, POPCODE AS STATS_TRGT_VL
FROM (SELECT DISTINCT HCODE, PTNO, MIN(AGE) AS AGE, SEX, MIN(FDX) AS FDX, POPCODE FROM CNCR_RGST WHERE POPCODE = '04' GROUP BY HCODE, PTNO,SEX, POPCODE) A -- '04' 위암
WHERE FDX BETWEEN '20100101' AND '20211231'
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10001 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 환자수' AS SMRY_STATS_NM, 99010 AS TBL_ID, 9901002 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A 
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT 
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B 
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD;


-- 10002 //위암 음주여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.CUR_DRNK_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CUR_DRNK_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10002 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 음주여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10003 //위암 음주력여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DHIS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DHIS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10003 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 음주력여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10004 //위암 음주시작연령별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_STRT_AGE_VL) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_STRT_AGE_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10004 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 음주시작연령별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10005 //위암 음주종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_KNCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10005 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 음주종류별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10006 //위암 음주량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_QTY) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_QTY,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10006 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 음주량별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10007 //위암 음주횟수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_NT) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_NT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10007 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 음주횟수별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10008 //위암 음주기간년수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DRNK_DTRN_YCNT) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRNK_DTRN_YCNT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10008 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 음주기간년수별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10009 //위암 금주시작년도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.NDRK_STRT_YR) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.NDRK_STRT_YR,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10009 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 금주시작년도별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10010 //위암 흡연여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.CUR_SMOK_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CUR_SMOK_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10010 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 흡연여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10011 //위암 흡연력여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.SHIS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SHIS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10011 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 흡연력여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10012 //위암 흡연시작연령별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.SMOK_STRT_AGE_VL) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SMOK_STRT_AGE_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10012 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 흡연시작연령별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10013 //위암 흡연기간년수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.SMOK_DTRN_YCNT) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SMOK_DTRN_YCNT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10013 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 흡연기간년수별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001022 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10014 //위암 흡연량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.SMOK_QTY) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SMOK_QTY,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10014 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 흡연량별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10015 //위암 금연시작년도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.NSMK_STRT_YR) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.NSMK_STRT_YR,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10015 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 금연시작년도별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001024 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10016 //위암 병력여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10016 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001025 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10017 //위암 병력고지혈증여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_HL_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_HL_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10017 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력고지혈증여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001027 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10018 //위암 병력고혈압여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_HTN_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_HTN_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10018 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력고혈압여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001029 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10019 //위암 병력당뇨여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_DBT_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_DBT_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10019 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력당뇨여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001031 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10020 //위암 병력결핵여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_TB_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_TB_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10020 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력결핵여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001033 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10021 //위암 병력간질환여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_LVDS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_LVDS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10021 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력간질환여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001035 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10022 //위암 병력암여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_CNCR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_CNCR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10022 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력암여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001037 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10023 //위암 병력암종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_CNCR_KNCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_CNCR_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10023 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력암종류별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001039 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10024 //위암 병력우울증여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_DEPR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_DEPR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10024 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력우울증여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001041 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10025 //위암 병력불면증여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_INSM_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_INSM_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10025 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력불면증여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001043 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10026 //위암 병력심장질환여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MHIS_CADS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MHIS_CADS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10026 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 병력심장질환여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001045 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10029 //위암 주증상내용별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MAIN_SYM_CONT) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MAIN_SYM_CONT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10029 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 주증상내용별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001050 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10030 //위암 주증상여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.MAIN_SYM_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MAIN_SYM_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10030 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 주증상여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001051 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10031 //위암 타병원진단후전원여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.OHAD_HSTR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OHAD_HSTR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10031 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 타병원진단후전원여부별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001053 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10032 //위암 퇴원상태별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, SUBSTRING(A.ADM_YMD,1,4) AS CRIT_YR, count(A.DSCH_STCD) as STATS_TRGT_CNT
from GSCN_PT_HLINF A 
where  A.ADM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ADM_YMD,1,4),  A.ADM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ADM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ADM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DSCH_STCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_HLINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10032 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 퇴원상태별' AS SMRY_STATS_NM, 10010 AS TBL_ID, 1001055 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10033 //위암 가족력여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHT_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHT_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10033 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 가족력여부별' AS SMRY_STATS_NM, 10020 AS TBL_ID, 1002005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10034 //위암 환자가족관계별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.PT_FM_RLCD) as STATS_TRGT_CNT
from GSCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.PT_FM_RLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10034 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 환자가족관계별' AS SMRY_STATS_NM, 10020 AS TBL_ID, 1002007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10036 //위암 가족병력고혈압여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHS_HTN_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHS_HTN_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10036 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 가족병력고혈압여부별' AS SMRY_STATS_NM, 10020 AS TBL_ID, 1002010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10037 //위암 가족병력당뇨여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHS_DBT_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHS_DBT_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10037 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 가족병력당뇨여부별' AS SMRY_STATS_NM, 10020 AS TBL_ID, 1002012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10038 //위암 가족력결핵여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHT_TB_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHT_TB_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10038 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 가족력결핵여부별' AS SMRY_STATS_NM, 10020 AS TBL_ID, 1002014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10039 //위암 가족병력간질환여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHS_LVDS_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHS_LVDS_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10039 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 가족병력간질환여부별' AS SMRY_STATS_NM, 10020 AS TBL_ID, 1002016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10040 //위암 가족병력암여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHS_CNCR_YN_NOANS_SPCD) as STATS_TRGT_CNT
from GSCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHS_CNCR_YN_NOANS_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10040 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 가족병력암여부별' AS SMRY_STATS_NM, 10020 AS TBL_ID, 1002018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10041 //위암 가족력암종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, SUBSTRING(A.FMHT_RCRD_YMD,1,4) AS CRIT_YR, count(A.FMHT_CNCR_KNCD) as STATS_TRGT_CNT
from GSCN_PT_FMHT A 
where  A.FMHT_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.FMHT_RCRD_YMD,1,4),  A.FMHT_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.FMHT_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.FMHT_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FMHT_CNCR_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_PT_FMHT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10041 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 가족력암종류별' AS SMRY_STATS_NM, 10020 AS TBL_ID, 1002020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10045 //위암 신장측정별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.HT_MSRM_VL) as STATS_TRGT_CNT
from GSCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.HT_MSRM_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10045 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 신장측정별' AS SMRY_STATS_NM, 10030 AS TBL_ID, 1003005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10046 //위암 체중측정별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.WT_MSRM_VL) as STATS_TRGT_CNT
from GSCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.WT_MSRM_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10046 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 체중측정별' AS SMRY_STATS_NM, 10030 AS TBL_ID, 1003006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10047 //위암 BMI별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.BMI_VL) as STATS_TRGT_CNT
from GSCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BMI_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10047 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 BMI별' AS SMRY_STATS_NM, 10030 AS TBL_ID, 1003007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10048 //위암 이완혈압별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.RLXT_BLPR_VL) as STATS_TRGT_CNT
from GSCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RLXT_BLPR_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10048 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 이완혈압별' AS SMRY_STATS_NM, 10030 AS TBL_ID, 1003008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10049 //위암 수축혈압별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.CTRT_BLPR_VL) as STATS_TRGT_CNT
from GSCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CTRT_BLPR_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10049 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수축혈압별' AS SMRY_STATS_NM, 10030 AS TBL_ID, 1003009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10050 //위암 ECOG코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, SUBSTRING(A.ANTH_RCRD_YMD,1,4) AS CRIT_YR, count(A.ECOG_CD) as STATS_TRGT_CNT
from GSCN_DIAG_ANINF A 
where  A.ANTH_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTH_RCRD_YMD,1,4),  A.ANTH_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTH_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTH_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ECOG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_ANINF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10050 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ECOG코드별' AS SMRY_STATS_NM, 10030 AS TBL_ID, 1003010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10051 //위암 위암진단종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, SUBSTRING(A.DIAG_RGST_YMD,1,4) AS CRIT_YR, count(A.GSCN_DIAG_KNCD) as STATS_TRGT_CNT
from GSCN_DIAG_INF A 
where  A.DIAG_RGST_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_RGST_YMD,1,4),  A.DIAG_RGST_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.GSCN_DIAG_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_INF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10051 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 위암진단종류별' AS SMRY_STATS_NM, 10040 AS TBL_ID, 1004005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10219 //위암 진단KCD코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, SUBSTRING(A.DIAG_RGST_YMD,1,4) AS CRIT_YR, count(A.DIAG_KCD_CD) as STATS_TRGT_CNT
from GSCN_DIAG_INF A 
where  A.DIAG_RGST_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_RGST_YMD,1,4),  A.DIAG_RGST_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DIAG_KCD_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_INF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10219 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단KCD코드별' AS SMRY_STATS_NM, 10040 AS TBL_ID, 1004009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10052 //위암 진단SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, SUBSTRING(A.DIAG_RGST_YMD,1,4) AS CRIT_YR, count(A.DIAG_SMCT_CD) as STATS_TRGT_CNT
from GSCN_DIAG_INF A 
where  A.DIAG_RGST_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_RGST_YMD,1,4),  A.DIAG_RGST_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DIAG_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_INF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10052 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단SNOMEDCT코드별' AS SMRY_STATS_NM, 10040 AS TBL_ID, 1004011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10053 //위암 진단SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, SUBSTRING(A.DIAG_RGST_YMD,1,4) AS CRIT_YR, count(A.DIAG_SMCT_NM) as STATS_TRGT_CNT
from GSCN_DIAG_INF A 
where  A.DIAG_RGST_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_RGST_YMD,1,4),  A.DIAG_RGST_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_RGST_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_RGST_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DIAG_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_INF B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10053 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단SNOMEDCT명별' AS SMRY_STATS_NM, 10040 AS TBL_ID, 1004012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10054 //위암 임상종양특성별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_TUMR_PRTY_CD) as STATS_TRGT_CNT
from GSCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_TUMR_PRTY_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10054 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 임상종양특성별' AS SMRY_STATS_NM, 10050 AS TBL_ID, 1005005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10055 //위암 AJCC년도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.AJCC_YR) as STATS_TRGT_CNT
from GSCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AJCC_YR,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10055 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 AJCC년도별' AS SMRY_STATS_NM, 10050 AS TBL_ID, 1005007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10056 //위암 임상TNM병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_TNM_STAG_VL) as STATS_TRGT_CNT
from GSCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_TNM_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10056 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 임상TNM병기별' AS SMRY_STATS_NM, 10050 AS TBL_ID, 1005008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10057 //위암 임상T병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_T_STAG_VL) as STATS_TRGT_CNT
from GSCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_T_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10057 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 임상T병기별' AS SMRY_STATS_NM, 10050 AS TBL_ID, 1005009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10058 //위암 임상N병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_N_STAG_VL) as STATS_TRGT_CNT
from GSCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_N_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10058 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 임상N병기별' AS SMRY_STATS_NM, 10050 AS TBL_ID, 1005010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10059 //위암 임상M병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4) AS CRIT_YR, count(A.CLNC_M_STAG_VL) as STATS_TRGT_CNT
from GSCN_DIAG_STAG A 
where  A.DIAG_STAG_RCRD_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DIAG_STAG_RCRD_YMD,1,4),  A.DIAG_STAG_RCRD_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DIAG_STAG_RCRD_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DIAG_STAG_RCRD_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CLNC_M_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_STAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10059 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 임상M병기별' AS SMRY_STATS_NM, 10050 AS TBL_ID, 1005011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10060 //위암 전이진단방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, SUBSTRING(A.MTDG_YMD,1,4) AS CRIT_YR, count(A.MTDG_MTCD) as STATS_TRGT_CNT
from GSCN_DIAG_MTST A 
where  A.MTDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MTDG_YMD,1,4),  A.MTDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MTDG_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_MTST B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10060 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 전이진단방법별' AS SMRY_STATS_NM, 10060 AS TBL_ID, 1006005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10061 //위암 전이부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, SUBSTRING(A.MTDG_YMD,1,4) AS CRIT_YR, count(A.MTST_SITE_CD) as STATS_TRGT_CNT
from GSCN_DIAG_MTST A 
where  A.MTDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MTDG_YMD,1,4),  A.MTDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MTST_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_MTST B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10061 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 전이부위별' AS SMRY_STATS_NM, 10060 AS TBL_ID, 1006007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10062 //위암 전이양상별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, SUBSTRING(A.MTDG_YMD,1,4) AS CRIT_YR, count(A.MTST_ASPT_CD) as STATS_TRGT_CNT
from GSCN_DIAG_MTST A 
where  A.MTDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MTDG_YMD,1,4),  A.MTDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MTDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MTDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MTST_ASPT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_MTST B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10062 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 전이양상별' AS SMRY_STATS_NM, 10060 AS TBL_ID, 1006009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10063 //위암 진단검사종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_KNCD) as STATS_TRGT_CNT
from GSCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10063 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단검사종류별' AS SMRY_STATS_NM, 10070 AS TBL_ID, 1007005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10064 //위암 진단검사EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_EDI_CD) as STATS_TRGT_CNT
from GSCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10064 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단검사EDI코드별' AS SMRY_STATS_NM, 10070 AS TBL_ID, 1007009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10065 //위암 진단검사EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_EDI_NM) as STATS_TRGT_CNT
from GSCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10065 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단검사EDI명별' AS SMRY_STATS_NM, 10070 AS TBL_ID, 1007010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10066 //위암 진단검사SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_SMCT_CD) as STATS_TRGT_CNT
from GSCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10066 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단검사SNOMEDCT코드별' AS SMRY_STATS_NM, 10070 AS TBL_ID, 1007011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10067 //위암 진단검사SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_SMCT_NM) as STATS_TRGT_CNT
from GSCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10067 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단검사SNOMEDCT명별' AS SMRY_STATS_NM, 10070 AS TBL_ID, 1007012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10068 //위암 진단검사LOINC코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_LOINC_CD) as STATS_TRGT_CNT
from GSCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_LOINC_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10068 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단검사LOINC코드별' AS SMRY_STATS_NM, 10070 AS TBL_ID, 1007013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10069 //위암 진단검사LOINC명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, SUBSTRING(A.CEXM_YMD,1,4) AS CRIT_YR, count(A.CEXM_LOINC_NM) as STATS_TRGT_CNT
from GSCN_EXAM_DIAG A 
where  A.CEXM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.CEXM_YMD,1,4),  A.CEXM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.CEXM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.CEXM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CEXM_LOINC_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_DIAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10069 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단검사LOINC명별' AS SMRY_STATS_NM, 10070 AS TBL_ID, 1007014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10070 //위암 영상검사종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_KNCD) as STATS_TRGT_CNT
from GSCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10070 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 영상검사종류별' AS SMRY_STATS_NM, 10080 AS TBL_ID, 1008005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10071 //위암 영상검사EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_EDI_CD) as STATS_TRGT_CNT
from GSCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10071 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 영상검사EDI코드별' AS SMRY_STATS_NM, 10080 AS TBL_ID, 1008009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10072 //위암 영상검사EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_EDI_NM) as STATS_TRGT_CNT
from GSCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10072 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 영상검사EDI명별' AS SMRY_STATS_NM, 10080 AS TBL_ID, 1008010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10073 //위암 영상검사SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_SMCT_CD) as STATS_TRGT_CNT
from GSCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10073 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 영상검사SNOMEDCT코드별' AS SMRY_STATS_NM, 10080 AS TBL_ID, 1008011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10074 //위암 영상검사SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, SUBSTRING(A.IMEX_YMD,1,4) AS CRIT_YR, count(A.IMEX_SMCT_NM) as STATS_TRGT_CNT
from GSCN_EXAM_IMAG A 
where  A.IMEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEX_YMD,1,4),  A.IMEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEX_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_IMAG B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10074 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 영상검사SNOMEDCT명별' AS SMRY_STATS_NM, 10080 AS TBL_ID, 1008012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10075 //위암 면역병리검사명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, SUBSTRING(A.IMEM_YMD,1,4) AS CRIT_YR, count(A.IMEM_NM) as STATS_TRGT_CNT
from GSCN_EXAM_IMPT A 
where  A.IMEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEM_YMD,1,4),  A.IMEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEM_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_IMPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10075 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 면역병리검사명별' AS SMRY_STATS_NM, 10090 AS TBL_ID, 1009007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10076 //위암 면역병리검사종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, SUBSTRING(A.IMEM_YMD,1,4) AS CRIT_YR, count(A.IMEM_KNCD) as STATS_TRGT_CNT
from GSCN_EXAM_IMPT A 
where  A.IMEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEM_YMD,1,4),  A.IMEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEM_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_IMPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10076 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 면역병리검사종류별' AS SMRY_STATS_NM, 10090 AS TBL_ID, 1009008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10077 //위암 면역병리검사소견별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, SUBSTRING(A.IMEM_YMD,1,4) AS CRIT_YR, count(A.IMEM_OPN_CD) as STATS_TRGT_CNT
from GSCN_EXAM_IMPT A 
where  A.IMEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.IMEM_YMD,1,4),  A.IMEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.IMEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.IMEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IMEM_OPN_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_IMPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10077 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 면역병리검사소견별' AS SMRY_STATS_NM, 10090 AS TBL_ID, 1009011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10078 //위암 분자병리검사종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, SUBSTRING(A.MLEM_YMD,1,4) AS CRIT_YR, count(A.MLEM_KNCD) as STATS_TRGT_CNT
from GSCN_EXAM_MLPT A 
where  A.MLEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MLEM_YMD,1,4),  A.MLEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MLEM_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_MLPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10078 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 분자병리검사종류별' AS SMRY_STATS_NM, 10100 AS TBL_ID, 1010008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10079 //위암 분자병리검사소견별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, SUBSTRING(A.MLEM_YMD,1,4) AS CRIT_YR, count(A.MLEM_OPN_CD) as STATS_TRGT_CNT
from GSCN_EXAM_MLPT A 
where  A.MLEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.MLEM_YMD,1,4),  A.MLEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.MLEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.MLEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MLEM_OPN_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_MLPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10079 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 분자병리검사소견별' AS SMRY_STATS_NM, 10100 AS TBL_ID, 1010012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10080 //위암 생체검사부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.BPSY_SITE_CD) as STATS_TRGT_CNT
from GSCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BPSY_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10080 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 생체검사부위별' AS SMRY_STATS_NM, 10110 AS TBL_ID, 1011006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10081 //위암 생체검사방법종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.BPSY_MTHD_KNCD) as STATS_TRGT_CNT
from GSCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BPSY_MTHD_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10081 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 생체검사방법종류별' AS SMRY_STATS_NM, 10110 AS TBL_ID, 1011010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10082 //위암 생체검사결과내용별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.BPSY_RSLT_CONT) as STATS_TRGT_CNT
from GSCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BPSY_RSLT_CONT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10082 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 생체검사결과내용별' AS SMRY_STATS_NM, 10110 AS TBL_ID, 1011012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10083 //위암 조직학적진단별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.HTLG_DIAG_CD) as STATS_TRGT_CNT
from GSCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HTLG_DIAG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10083 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 조직학적진단별' AS SMRY_STATS_NM, 10110 AS TBL_ID, 1011013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10084 //위암 조직학적분화도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, SUBSTRING(A.BPSY_YMD,1,4) AS CRIT_YR, count(A.HTLG_DFGD_CD) as STATS_TRGT_CNT
from GSCN_EXAM_BYPS A 
where  A.BPSY_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BPSY_YMD,1,4),  A.BPSY_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BPSY_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BPSY_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HTLG_DFGD_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_BYPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10084 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 조직학적분화도별' AS SMRY_STATS_NM, 10110 AS TBL_ID, 1011015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10085 //위암 HPYLORI검사방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.HPLI_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.HPLI_EXAM_YMD, SUBSTRING(A.HPLI_EXAM_YMD,1,4) AS CRIT_YR, count(A.HPLI_EXAM_MTCD) as STATS_TRGT_CNT
from GSCN_EXAM_HPLI A 
where  A.HPLI_EXAM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.HPLI_EXAM_YMD,1,4),  A.HPLI_EXAM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.HPLI_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HPLI_EXAM_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_HPLI B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10085 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 HPYLORI검사방법별' AS SMRY_STATS_NM, 10120 AS TBL_ID, 1012005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10086 //위암 HPYLORI검사결과별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.HPLI_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.HPLI_EXAM_YMD, SUBSTRING(A.HPLI_EXAM_YMD,1,4) AS CRIT_YR, count(A.HPLI_EXAM_RSLT_CD) as STATS_TRGT_CNT
from GSCN_EXAM_HPLI A 
where  A.HPLI_EXAM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.HPLI_EXAM_YMD,1,4),  A.HPLI_EXAM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.HPLI_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.HPLI_EXAM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HPLI_EXAM_RSLT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_HPLI B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10086 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 HPYLORI검사결과별' AS SMRY_STATS_NM, 10120 AS TBL_ID, 1012007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10087 //위암 위내시경검사목적별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, SUBSTRING(A.STMC_EDEX_YMD,1,4) AS CRIT_YR, count(A.STMC_EDEX_PRPS_CD) as STATS_TRGT_CNT
from GSCN_EXAM_GTSP A 
where  A.STMC_EDEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.STMC_EDEX_YMD,1,4),  A.STMC_EDEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.STMC_EDEX_PRPS_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_GTSP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10087 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 위내시경검사목적별' AS SMRY_STATS_NM, 10130 AS TBL_ID, 1013005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10088 //위암 위내시경조직표본수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, SUBSTRING(A.STMC_EDEX_YMD,1,4) AS CRIT_YR, count(A.GTSP_TSPC_CNT) as STATS_TRGT_CNT
from GSCN_EXAM_GTSP A 
where  A.STMC_EDEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.STMC_EDEX_YMD,1,4),  A.STMC_EDEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.GTSP_TSPC_CNT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_GTSP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10088 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 위내시경조직표본수별' AS SMRY_STATS_NM, 10130 AS TBL_ID, 1013007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10089 //위암 위내시경검사결과내용별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, SUBSTRING(A.STMC_EDEX_YMD,1,4) AS CRIT_YR, count(A.STMC_EDEX_RSLT_CONT) as STATS_TRGT_CNT
from GSCN_EXAM_GTSP A 
where  A.STMC_EDEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.STMC_EDEX_YMD,1,4),  A.STMC_EDEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.STMC_EDEX_RSLT_CONT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_GTSP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10089 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 위내시경검사결과내용별' AS SMRY_STATS_NM, 10130 AS TBL_ID, 1013009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10090 //위암 위내시경검사결과유형별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, SUBSTRING(A.STMC_EDEX_YMD,1,4) AS CRIT_YR, count(A.STMC_EDEX_RSLT_TPCD) as STATS_TRGT_CNT
from GSCN_EXAM_GTSP A 
where  A.STMC_EDEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.STMC_EDEX_YMD,1,4),  A.STMC_EDEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.STMC_EDEX_RSLT_TPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_GTSP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10090 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 위내시경검사결과유형별' AS SMRY_STATS_NM, 10130 AS TBL_ID, 1013010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10091 //위암 위내시경합병증등급별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, SUBSTRING(A.STMC_EDEX_YMD,1,4) AS CRIT_YR, count(A.GTSP_COMP_GRCD) as STATS_TRGT_CNT
from GSCN_EXAM_GTSP A 
where  A.STMC_EDEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.STMC_EDEX_YMD,1,4),  A.STMC_EDEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.GTSP_COMP_GRCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_GTSP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10091 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 위내시경합병증등급별' AS SMRY_STATS_NM, 10130 AS TBL_ID, 1013012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10092 //위암 위내시경합병증별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, SUBSTRING(A.STMC_EDEX_YMD,1,4) AS CRIT_YR, count(A.GTSP_COMP_CD) as STATS_TRGT_CNT
from GSCN_EXAM_GTSP A 
where  A.STMC_EDEX_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.STMC_EDEX_YMD,1,4),  A.STMC_EDEX_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.STMC_EDEX_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.STMC_EDEX_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.GTSP_COMP_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_GTSP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10092 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 위내시경합병증별' AS SMRY_STATS_NM, 10130 AS TBL_ID, 1013014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10093 //위암 EUS_T병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, SUBSTRING(A.EUS_EXAM_YMD,1,4) AS CRIT_YR, count(A.EUS_T_STAG_CD) as STATS_TRGT_CNT
from GSCN_EXAM_EUS A 
where  A.EUS_EXAM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.EUS_EXAM_YMD,1,4),  A.EUS_EXAM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.EUS_T_STAG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_EUS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10093 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 EUS_T병기별' AS SMRY_STATS_NM, 10140 AS TBL_ID, 1014005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10094 //위암 EUS_N병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, SUBSTRING(A.EUS_EXAM_YMD,1,4) AS CRIT_YR, count(A.EUS_N_STAG_CD) as STATS_TRGT_CNT
from GSCN_EXAM_EUS A 
where  A.EUS_EXAM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.EUS_EXAM_YMD,1,4),  A.EUS_EXAM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.EUS_N_STAG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_EUS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10094 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 EUS_N병기별' AS SMRY_STATS_NM, 10140 AS TBL_ID, 1014007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10095 //위암 EUS_M병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, SUBSTRING(A.EUS_EXAM_YMD,1,4) AS CRIT_YR, count(A.EUS_M_STAG_CD) as STATS_TRGT_CNT
from GSCN_EXAM_EUS A 
where  A.EUS_EXAM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.EUS_EXAM_YMD,1,4),  A.EUS_EXAM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.EUS_M_STAG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_EUS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10095 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 EUS_M병기별' AS SMRY_STATS_NM, 10140 AS TBL_ID, 1014009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10096 //위암 EUS합병증별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, SUBSTRING(A.EUS_EXAM_YMD,1,4) AS CRIT_YR, count(A.EUS_COMP_CD) as STATS_TRGT_CNT
from GSCN_EXAM_EUS A 
where  A.EUS_EXAM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.EUS_EXAM_YMD,1,4),  A.EUS_EXAM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.EUS_EXAM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.EUS_EXAM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.EUS_COMP_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_EUS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10096 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 EUS합병증별' AS SMRY_STATS_NM, 10140 AS TBL_ID, 1014013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10097 //위암 수술종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_KNCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10097 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술종류별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10098 //위암 수술EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_EDI_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10098 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술EDI코드별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10099 //위암 수술EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_EDI_NM) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10099 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술EDI명별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10100 //위암 수술SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_SMCT_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10100 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술SNOMEDCT코드별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10101 //위암 수술SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_SMCT_NM) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10101 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술SNOMEDCT명별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10102 //위암 수술ICD9CM명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_ICD9CM_NM) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_ICD9CM_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10102 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술ICD9CM명별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10103 //위암 수술목적별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_PRPS_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_PRPS_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10103 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술목적별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10104 //위암 수술방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_MTCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10104 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술방법별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10105 //위암 수술마취부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_ANST_SITE_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_ANST_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10105 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술마취부위별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10106 //위암 ASA점수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.ASA_SCOR_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ASA_SCOR_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10106 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ASA점수별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015022 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10107 //위암 수술절개방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_INCS_MTCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_INCS_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10107 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술절개방법별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015024 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10108 //위암 수술둘레방향종양위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_CRMR_TUMR_LOCA_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_CRMR_TUMR_LOCA_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10108 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술둘레방향종양위치별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015026 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10109 //위암 수술종방향1종양위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_LNGT_1_TUMR_LOCA_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_LNGT_1_TUMR_LOCA_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10109 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술종방향1종양위치별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015028 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10110 //위암 수술종방향2종양위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_LNGT_2_TUMR_LOCA_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_LNGT_2_TUMR_LOCA_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10110 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술종방향2종양위치별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015030 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10111 //위암 진단복강경검사여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.DIAG_LPEX_YN_UNID_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DIAG_LPEX_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10111 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 진단복강경검사여부확인불가구분별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015032 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10112 //위암 수술장내시경사용여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRM_ENSP_USE_YN_UNID_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRM_ENSP_USE_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10112 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술장내시경사용여부확인불가구분별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015034 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10113 //위암 형광영상사용여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.FLRN_IMAG_USE_YN_UNID_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.FLRN_IMAG_USE_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10113 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 형광영상사용여부확인불가구분별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015036 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10114 //위암 수술시항암요법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.INOP_ANTP_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.INOP_ANTP_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10114 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술시항암요법별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015038 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10115 //위암 유착방지제사용여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.ADH_IBTR_USE_YN_UNID_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ADH_IBTR_USE_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10115 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 유착방지제사용여부확인불가구분별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015040 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10116 //위암 유착방지제제품명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.ADH_IBTR_GODS_NM) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ADH_IBTR_GODS_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10116 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 유착방지제제품명별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015042 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10117 //위암 그물막절제범위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OMNL_SRMV_RANG_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OMNL_SRMV_RANG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10117 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 그물막절제범위별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015043 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10118 //위암 근치도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.CURDG_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.CURDG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10118 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 근치도별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015045 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10119 //위암 림프절절제정도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.LN_SRMV_DGRE_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.LN_SRMV_DGRE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10119 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 림프절절제정도별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015047 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10120 //위암 림프절절제정도상세내용별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.LN_SRMV_DGRE_DETL_CONT) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.LN_SRMV_DGRE_DETL_CONT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10120 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 림프절절제정도상세내용별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015049 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10121 //위암 합병절제부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.MRGE_SRMV_SITE_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.MRGE_SRMV_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10121 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 합병절제부위별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015050 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10122 //위암 재건술종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.REPR_KNCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.REPR_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10122 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 재건술종류별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015052 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10123 //위암 재건술사용도구명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.REPR_USE_DVCE_NM) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.REPR_USE_DVCE_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10123 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 재건술사용도구명별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015054 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10124 //위암 재건술방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.REPR_MTCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.REPR_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10124 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 재건술방법별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015055 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10125 //위암 재건술접근법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.REPR_APRMTHD_CD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.REPR_APRMTHD_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10125 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 재건술접근법별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015057 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10126 //위암 수술추정실혈량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.OPRT_EBL_QTY) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.OPRT_EBL_QTY),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10126 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술추정실혈량별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015059 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10127 //위암 복수여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, SUBSTRING(A.OPRT_YMD,1,4) AS CRIT_YR, count(A.ASCT_YN_UNID_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_OPRT A 
where  A.OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.OPRT_YMD,1,4),  A.OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ASCT_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_OPRT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10127 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 복수여부확인불가구분별' AS SMRY_STATS_NM, 10150 AS TBL_ID, 1015060 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10128 //위암 ESD병변크기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, SUBSTRING(A.ESD_SRPR_YMD,1,4) AS CRIT_YR, count(A.ESD_LESN_SIZE_VL) as STATS_TRGT_CNT
from GSCN_TRTM_SRPR A 
where  A.ESD_SRPR_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ESD_SRPR_YMD,1,4),  A.ESD_SRPR_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.ESD_LESN_SIZE_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_SRPR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10128 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD병변크기별' AS SMRY_STATS_NM, 10160 AS TBL_ID, 1016007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10129 //위암 ESD병변모양별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, SUBSTRING(A.ESD_SRPR_YMD,1,4) AS CRIT_YR, count(A.ESD_LESN_SHAP_CD) as STATS_TRGT_CNT
from GSCN_TRTM_SRPR A 
where  A.ESD_SRPR_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ESD_SRPR_YMD,1,4),  A.ESD_SRPR_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_LESN_SHAP_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_SRPR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10129 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD병변모양별' AS SMRY_STATS_NM, 10160 AS TBL_ID, 1016008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10130 //위암 ESD병변가로위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, SUBSTRING(A.ESD_SRPR_YMD,1,4) AS CRIT_YR, count(A.ESD_LESN_LOCA_WDTH_CD) as STATS_TRGT_CNT
from GSCN_TRTM_SRPR A 
where  A.ESD_SRPR_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ESD_SRPR_YMD,1,4),  A.ESD_SRPR_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_LESN_LOCA_WDTH_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_SRPR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10130 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD병변가로위치별' AS SMRY_STATS_NM, 10160 AS TBL_ID, 1016010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10131 //위암 ESD병변세로위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, SUBSTRING(A.ESD_SRPR_YMD,1,4) AS CRIT_YR, count(A.ESD_LESN_LOCA_LGTD_CD) as STATS_TRGT_CNT
from GSCN_TRTM_SRPR A 
where  A.ESD_SRPR_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ESD_SRPR_YMD,1,4),  A.ESD_SRPR_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_LESN_LOCA_LGTD_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_SRPR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10131 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD병변세로위치별' AS SMRY_STATS_NM, 10160 AS TBL_ID, 1016012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10132 //위암 ESD궤양여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, SUBSTRING(A.ESD_SRPR_YMD,1,4) AS CRIT_YR, count(A.ESD_ULCR_YN_UNID_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_SRPR A 
where  A.ESD_SRPR_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ESD_SRPR_YMD,1,4),  A.ESD_SRPR_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_ULCR_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_SRPR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10132 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD궤양여부확인불가구분별' AS SMRY_STATS_NM, 10160 AS TBL_ID, 1016014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10133 //위암 ESD천공여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, SUBSTRING(A.ESD_SRPR_YMD,1,4) AS CRIT_YR, count(A.ESD_PERF_YN_UNID_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_SRPR A 
where  A.ESD_SRPR_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ESD_SRPR_YMD,1,4),  A.ESD_SRPR_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_PERF_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_SRPR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10133 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD천공여부확인불가구분별' AS SMRY_STATS_NM, 10160 AS TBL_ID, 1016016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10134 //위암 ESD천공조치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, SUBSTRING(A.ESD_SRPR_YMD,1,4) AS CRIT_YR, count(A.ESD_PERF_MSRE_CD) as STATS_TRGT_CNT
from GSCN_TRTM_SRPR A 
where  A.ESD_SRPR_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ESD_SRPR_YMD,1,4),  A.ESD_SRPR_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_PERF_MSRE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_SRPR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10134 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD천공조치별' AS SMRY_STATS_NM, 10160 AS TBL_ID, 1016018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10135 //위암 ESD결과별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, SUBSTRING(A.ESD_SRPR_YMD,1,4) AS CRIT_YR, count(A.ESD_RSLT_CD) as STATS_TRGT_CNT
from GSCN_TRTM_SRPR A 
where  A.ESD_SRPR_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ESD_SRPR_YMD,1,4),  A.ESD_SRPR_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_RSLT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_SRPR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10135 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD결과별' AS SMRY_STATS_NM, 10160 AS TBL_ID, 1016020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10136 //위암 ESD소견내용별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, SUBSTRING(A.ESD_SRPR_YMD,1,4) AS CRIT_YR, count(A.ESD_OPN_CONT) as STATS_TRGT_CNT
from GSCN_TRTM_SRPR A 
where  A.ESD_SRPR_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ESD_SRPR_YMD,1,4),  A.ESD_SRPR_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ESD_SRPR_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ESD_SRPR_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_OPN_CONT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_SRPR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10136 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD소견내용별' AS SMRY_STATS_NM, 10160 AS TBL_ID, 1016022 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10137 //위암 외과병리채취부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.SGPT_HVST_SITE_CD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.SGPT_HVST_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10137 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 외과병리채취부위별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10138 //위암 외과병리검사결과종양수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.SRGC_PTEM_RSLT_TUMR_CNT) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.SRGC_PTEM_RSLT_TUMR_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10138 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 외과병리검사결과종양수별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10139 //위암 조직학적진단별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.HTLG_DIAG_CD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HTLG_DIAG_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10139 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 조직학적진단별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10140 //위암 조직학적분화도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.HTLG_DFGD_CD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.HTLG_DFGD_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10140 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 조직학적분화도별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10141 //위암 수술후둘레방향종양위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_CRMR_TUMR_LOCA_CD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_CRMR_TUMR_LOCA_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10141 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술후둘레방향종양위치별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10142 //위암 수술후종방향1종양위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_LNGT_1_TUMR_LOCA_CD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_LNGT_1_TUMR_LOCA_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10142 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술후종방향1종양위치별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10143 //위암 수술후종방향2종양위치별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_LNGT_2_TUMR_LOCA_CD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_LNGT_2_TUMR_LOCA_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10143 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술후종방향2종양위치별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10144 //위암 GROSS유형별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.GROS_TPCD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.GROS_TPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10144 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 GROSS유형별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10145 //위암 종양가로길이별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.TUMR_WDTH_LNTH_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.TUMR_WDTH_LNTH_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10145 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 종양가로길이별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017022 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10146 //위암 종양세로길이별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.TUMR_LGTD_LNTH_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.TUMR_LGTD_LNTH_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10146 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 종양세로길이별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10147 //위암 종양높이별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.TUMR_HGHT_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.TUMR_HGHT_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10147 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 종양높이별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017024 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10148 //위암 종양최대직경별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.TUMR_MAX_DIAM_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.TUMR_MAX_DIAM_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10148 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 종양최대직경별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017025 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10149 //위암 침습장기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.IFLT_ORGN_CD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.IFLT_ORGN_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10149 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 침습장기별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017026 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10150 //위암 침윤정도별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.INVA_DGRE_CD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.INVA_DGRE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10150 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 침윤정도별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017028 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10151 //위암 침윤깊이별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.INVA_DPTH_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.INVA_DPTH_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10151 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 침윤깊이별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017030 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10152 //위암 림프성침윤존재여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.LYMP_INVA_EX_YN_SPCD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.LYMP_INVA_EX_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10152 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 림프성침윤존재여부별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017031 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10153 //위암 혈관성침윤존재여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.VASC_INVA_EX_YN_SPCD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.VASC_INVA_EX_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10153 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 혈관성침윤존재여부별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017033 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10154 //위암 신경주위침윤존재여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.NERV_PREX_EX_YN_SPCD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.NERV_PREX_EX_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10154 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 신경주위침윤존재여부별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017035 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10155 //위암 수술근위절제면잔존암포함여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.OPRT_PMRG_RLCR_INVL_YN_SPCD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_PMRG_RLCR_INVL_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10155 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술근위절제면잔존암포함여부별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017037 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10156 //위암 수술근위절제면크기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.OPRT_PMRG_SIZE_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.OPRT_PMRG_SIZE_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10156 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술근위절제면크기별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017039 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10157 //위암 수술원위절제면잔존암포함여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.OPRT_DMRG_RLCR_INVL_YN_SPCD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.OPRT_DMRG_RLCR_INVL_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10157 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술원위절제면잔존암포함여부별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017040 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10158 //위암 수술원위절제면크기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.OPRT_DMRG_SIZE_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.OPRT_DMRG_SIZE_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10158 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술원위절제면크기별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017042 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10159 //위암 위식도경계부위암분류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.STES_BNST_CNCR_CLCD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.STES_BNST_CNCR_CLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10159 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 위식도경계부위암분류별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017043 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10160 //위암 총림프절수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.TOTL_LN_CNT) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.TOTL_LN_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10160 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 총림프절수별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017045 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10161 //위암 양성림프절수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.PSTV_LN_CNT) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.PSTV_LN_CNT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10161 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 양성림프절수별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017046 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10162 //위암 림프절위치별전이내용별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.LN_BYLC_MTST_CONT) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.LN_BYLC_MTST_CONT,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10162 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 림프절위치별전이내용별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017047 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10163 //위암 수술후병리TNM병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_PATH_TNM_STAG_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_PATH_TNM_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10163 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술후병리TNM병기별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017049 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10164 //위암 수술후병리T병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_PATH_T_STAG_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_PATH_T_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10164 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술후병리T병기별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017050 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10165 //위암 수술후병리N병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_PATH_N_STAG_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_PATH_N_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10165 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술후병리N병기별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017051 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10166 //위암 수술후병리M병기별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.AFOP_PATH_M_STAG_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOP_PATH_M_STAG_VL,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10166 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술후병리M병기별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017052 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10167 //위암 ESD수직절제면잔존암양성여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.ESD_VMRG_RLCR_PSTV_YN_SPCD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_VMRG_RLCR_PSTV_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10167 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD수직절제면잔존암양성여부별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017053 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10168 //위암 ESD수직절제면별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.ESD_VMRG_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.ESD_VMRG_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10168 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD수직절제면별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017055 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10169 //위암 ESD수평절제면잔존암양성여부별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.ESD_HMRG_RLCR_PSTV_YN_SPCD) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ESD_HMRG_RLCR_PSTV_YN_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10169 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD수평절제면잔존암양성여부별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017056 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10170 //위암 ESD수평절제면별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.ESD_HMRG_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.ESD_HMRG_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10170 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD수평절제면별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017058 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10171 //위암 ESD수평절제면잔존암길이별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, SUBSTRING(A.SRGC_PTEM_YMD,1,4) AS CRIT_YR, count(A.ESD_HMRG_RLCR_LNTH_VL) as STATS_TRGT_CNT
from GSCN_EXAM_SGPT A 
where  A.SRGC_PTEM_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.SRGC_PTEM_YMD,1,4),  A.SRGC_PTEM_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.SRGC_PTEM_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.SRGC_PTEM_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.ESD_HMRG_RLCR_LNTH_VL),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_EXAM_SGPT B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10171 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 ESD수평절제면잔존암길이별' AS SMRY_STATS_NM, 10170 AS TBL_ID, 1017059 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10172 //위암 수술후합병증분류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, SUBSTRING(A.COMP_OCRN_OPRT_YMD,1,4) AS CRIT_YR, count(A.AFOC_CLCD) as STATS_TRGT_CNT
from GSCN_DIAG_AFOC A 
where  A.COMP_OCRN_OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.COMP_OCRN_OPRT_YMD,1,4),  A.COMP_OCRN_OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOC_CLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_AFOC B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10172 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술후합병증분류별' AS SMRY_STATS_NM, 10180 AS TBL_ID, 1018005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10173 //위암 수술후합병증별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, SUBSTRING(A.COMP_OCRN_OPRT_YMD,1,4) AS CRIT_YR, count(A.AFOC_CD) as STATS_TRGT_CNT
from GSCN_DIAG_AFOC A 
where  A.COMP_OCRN_OPRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.COMP_OCRN_OPRT_YMD,1,4),  A.COMP_OCRN_OPRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.COMP_OCRN_OPRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.COMP_OCRN_OPRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.AFOC_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_DIAG_AFOC B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10173 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수술후합병증별' AS SMRY_STATS_NM, 10180 AS TBL_ID, 1018007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10174 //위암 혈액제제종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, SUBSTRING(A.BLTR_PRSC_YMD,1,4) AS CRIT_YR, count(A.BLPT_KNCD) as STATS_TRGT_CNT
from GSCN_TRTM_BLTR A 
where  A.BLTR_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BLTR_PRSC_YMD,1,4),  A.BLTR_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.BLPT_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_BLTR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10174 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 혈액제제종류별' AS SMRY_STATS_NM, 10190 AS TBL_ID, 1019005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10175 //위암 수혈팩수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, SUBSTRING(A.BLTR_PRSC_YMD,1,4) AS CRIT_YR, count(A.BLTR_PACK_CNT) as STATS_TRGT_CNT
from GSCN_TRTM_BLTR A 
where  A.BLTR_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BLTR_PRSC_YMD,1,4),  A.BLTR_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BLTR_PACK_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_BLTR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10175 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수혈팩수별' AS SMRY_STATS_NM, 10190 AS TBL_ID, 1019009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10176 //위암 수혈총량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, SUBSTRING(A.BLTR_PRSC_YMD,1,4) AS CRIT_YR, count(A.BLTR_TOTL_QTY) as STATS_TRGT_CNT
from GSCN_TRTM_BLTR A 
where  A.BLTR_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.BLTR_PRSC_YMD,1,4),  A.BLTR_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.BLTR_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.BLTR_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BLTR_TOTL_QTY),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_BLTR B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10176 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 수혈총량별' AS SMRY_STATS_NM, 10190 AS TBL_ID, 1019010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10177 //위암 약제분류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_CLCD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_CLCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10177 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제분류별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10178 //위암 약제구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10178 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제구분별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10179 //위암 약제성분종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_KNCD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10179 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제성분종류별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10180 //위암 약제성분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_CD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10180 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제성분별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10181 //위암 약제성분명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_NM) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10181 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제성분명별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10182 //위암 약제성분SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_SMCT_CD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10182 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제성분SNOMEDCT코드별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10183 //위암 약제성분SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRIN_SMCT_NM) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRIN_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10183 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제성분SNOMEDCT명별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020014 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10184 //위암 약제EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_EDI_CD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10184 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제EDI코드별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10185 //위암 약제EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_EDI_NM) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10185 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제EDI명별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10186 //위암 약제ATC코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_ATC_CD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_ATC_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10186 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제ATC코드별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10187 //위암 약제ATC명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_ATC_NM) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_ATC_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10187 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제ATC명별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10188 //위암 약제RXNORM코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_RXNM_CD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_RXNM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10188 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제RXNORM코드별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10189 //위암 약제RXNORM명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_RXNM_NM) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_RXNM_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10189 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제RXNORM명별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020022 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10190 //위암 약제처방용량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_PRSC_CAPA) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_PRSC_CAPA,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10190 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제처방용량별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10191 //위암 약제투여경로별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_INJC_PTH_CD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_INJC_PTH_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10191 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제투여경로별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020025 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10192 //위암 약제처방용량단위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_PRSC_CAPA_UNIT_CD) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.DRUG_PRSC_CAPA_UNIT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10192 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제처방용량단위별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020027 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10193 //위암 약제투약기간월수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, SUBSTRING(A.DRUG_PRSC_YMD,1,4) AS CRIT_YR, count(A.DRUG_MDCT_DTRN_MCNT) as STATS_TRGT_CNT
from GSCN_TRTM_DRIN A 
where  A.DRUG_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.DRUG_PRSC_YMD,1,4),  A.DRUG_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.DRUG_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.DRUG_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.DRUG_MDCT_DTRN_MCNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_DRIN B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10193 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 약제투약기간월수별' AS SMRY_STATS_NM, 10200 AS TBL_ID, 1020029 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10194 //위암 항암요법라인수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_LINE_CNT) as STATS_TRGT_CNT
from GSCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.ANTP_LINE_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10194 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 항암요법라인수별' AS SMRY_STATS_NM, 10210 AS TBL_ID, 1021006 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10195 //위암 항암요법총주기수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_TOTL_CYCL_CNT) as STATS_TRGT_CNT
from GSCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.ANTP_TOTL_CYCL_CNT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10195 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 항암요법총주기수별' AS SMRY_STATS_NM, 10210 AS TBL_ID, 1021007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10196 //위암 항암요법치료목적별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_TRTM_PRPS_CD) as STATS_TRGT_CNT
from GSCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_TRTM_PRPS_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10196 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 항암요법치료목적별' AS SMRY_STATS_NM, 10210 AS TBL_ID, 1021008 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10197 //위암 항암요법임시중단여부확인불가구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_TEMP_STOP_YN_UNID_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_TEMP_STOP_YN_UNID_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10197 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 항암요법임시중단여부확인불가구분별' AS SMRY_STATS_NM, 10210 AS TBL_ID, 1021011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10198 //위암 항암요법종료이유별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_END_RESN_CD) as STATS_TRGT_CNT
from GSCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_END_RESN_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10198 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 항암요법종료이유별' AS SMRY_STATS_NM, 10210 AS TBL_ID, 1021013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10199 //위암 항암요법평가항목별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_ASMT_ITEM_CD) as STATS_TRGT_CNT
from GSCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_ASMT_ITEM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10199 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 항암요법평가항목별' AS SMRY_STATS_NM, 10210 AS TBL_ID, 1021016 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10200 //위암 항암요법부작용별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_SEFF_CD) as STATS_TRGT_CNT
from GSCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_SEFF_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10200 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 항암요법부작용별' AS SMRY_STATS_NM, 10210 AS TBL_ID, 1021018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10201 //위암 항암요법부작용등급별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, SUBSTRING(A.ANTP_STRT_YMD,1,4) AS CRIT_YR, count(A.ANTP_SEFF_GRCD) as STATS_TRGT_CNT
from GSCN_TRTM_ANTP A 
where  A.ANTP_STRT_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.ANTP_STRT_YMD,1,4),  A.ANTP_STRT_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.ANTP_STRT_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.ANTP_STRT_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.ANTP_SEFF_GRCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_ANTP B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10201 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 항암요법부작용등급별' AS SMRY_STATS_NM, 10210 AS TBL_ID, 1021020 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10202 //위암 방사선치료종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_KNCD) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10202 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료종류별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10203 //위암 방사선치료EDI코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_EDI_CD) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_EDI_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10203 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료EDI코드별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10204 //위암 방사선치료EDI명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_EDI_NM) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_EDI_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10204 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료EDI명별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022010 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10205 //위암 방사선치료SNOMEDCT코드별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SMCT_CD) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SMCT_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10205 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료SNOMEDCT코드별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022011 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10206 //위암 방사선치료SNOMEDCT명별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SMCT_NM) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SMCT_NM,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10206 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료SNOMEDCT명별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022012 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10207 //위암 방사선치료목적별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_PRPS_CD) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_PRPS_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10207 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료목적별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022013 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10208 //위암 방사선치료부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SITE_CD) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10208 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료부위별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022015 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10209 //위암 부위별방사선시행횟수별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.BYST_RD_IMPL_NT) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BYST_RD_IMPL_NT),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10209 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 부위별방사선시행횟수별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022017 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10210 //위암 방사선선량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RD_GY) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.RD_GY),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10210 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선선량별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022018 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10211 //위암 부위별방사선총선량별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.BYST_RD_TOTL_GY) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(STR(B.BYST_RD_TOTL_GY),'#N/A' ) AS STATS_TRGT_VL -- NUMERIC 컬럼 변환(NULL은 '#N/A'로 대체)
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10211 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 부위별방사선총선량별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022019 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10212 //위암 방사선치료평가항목별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_ASMT_ITEM_CD) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_ASMT_ITEM_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10212 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료평가항목별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022021 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10213 //위암 방사선치료부작용시기구분별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SEFF_PERD_SPCD) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SEFF_PERD_SPCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10213 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료부작용시기구분별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022023 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10214 //위암 방사선치료부작용종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SEFF_KNCD) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SEFF_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10214 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료부작용종류별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022025 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10215 //위암 방사선치료부작용등급별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, SUBSTRING(A.RDT_PRSC_YMD,1,4) AS CRIT_YR, count(A.RDT_SEFF_GRCD) as STATS_TRGT_CNT
from GSCN_TRTM_RD A 
where  A.RDT_PRSC_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RDT_PRSC_YMD,1,4),  A.RDT_PRSC_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RDT_PRSC_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RDT_PRSC_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RDT_SEFF_GRCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_TRTM_RD B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10215 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 방사선치료부작용등급별' AS SMRY_STATS_NM, 10220 AS TBL_ID, 1022027 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10216 //위암 재발진단방법별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, SUBSTRING(A.RLDG_YMD,1,4) AS CRIT_YR, count(A.RLDG_MTCD) as STATS_TRGT_CNT
from GSCN_FUOR_RLPS A 
where  A.RLDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RLDG_YMD,1,4),  A.RLDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RLDG_MTCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_FUOR_RLPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10216 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 재발진단방법별' AS SMRY_STATS_NM, 10230 AS TBL_ID, 1023005 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10217 //위암 재발부위별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, SUBSTRING(A.RLDG_YMD,1,4) AS CRIT_YR, count(A.RLPS_SITE_CD) as STATS_TRGT_CNT
from GSCN_FUOR_RLPS A 
where  A.RLDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RLDG_YMD,1,4),  A.RLDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RLPS_SITE_CD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_FUOR_RLPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10217 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 재발부위별' AS SMRY_STATS_NM, 10230 AS TBL_ID, 1023007 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


-- 10218 //위암 재발종류별

WITH W2 AS( SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, B.SEX AS PT_SEX_CD, B.BRTH FROM
(select A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, SUBSTRING(A.RLDG_YMD,1,4) AS CRIT_YR, count(A.RLPS_KNCD) as STATS_TRGT_CNT
from GSCN_FUOR_RLPS A 
where  A.RLDG_YMD BETWEEN '20100101' AND '20211231'
group by A.HOSP_CD, A.PT_SBST_NO, SUBSTRING(A.RLDG_YMD,1,4),  A.RLDG_YMD) A
INNER JOIN (SELECT DISTINCT HCODE, PTNO, CONCAT(BRTH,'15') AS BRTH, SEX FROM CNCR_RGST WHERE BRTH IS NOT NULL AND  POPCODE = '04') B -- '04'위암
ON A.HOSP_CD = B.HCODE
AND A.PT_SBST_NO = B.PTNO
), W1 AS(
SELECT A.HOSP_CD, A.PT_SBST_NO, A.RLDG_YMD, A.CRIT_YR, A.STATS_TRGT_CNT, A.PT_SEX_CD, A.BRTH,
CASE WHEN A.STATS_TRGT_CNT = 0 THEN null ELSE 
CASE WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'20' THEN 10 --20세 미만
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'30' THEN 20  --20대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'40' THEN 30  --30대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'50' THEN 40  --40대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'60' THEN 50  --50대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'70' THEN 60  --60대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) <'80' THEN 70  --70대
     WHEN FLOOR(DATEDIFF(day,A.BRTH,A.RLDG_YMD)/365.25) >='80' THEN 80  --80대 이상
END END AS PT_AGE,
   ISNULL(B.RLPS_KNCD,'#N/A' ) AS STATS_TRGT_VL -- NULL은 '#N/A'로 대체
from W2 A 
INNER JOIN GSCN_FUOR_RLPS B
ON A.HOSP_CD = B.HOSP_CD
AND A.PT_SBST_NO = B.PT_SBST_NO
)
INSERT INTO CNCR_TBL_SMRY_STATS 
(SMRY_STATS_NO, HOSP_CD, CRIT_YR, SMRY_STATS_NM, TBL_ID, COL_ID, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, NCS, WHOL_NCS, PT_CNT, WHOL_PT_CNT, STATS_WORK_YMD, COLL_STRT_YMD, COLL_END_YMD, CRTN_DT) 
SELECT 10218 AS SMRY_STATS_NO, A.HOSP_CD, A.CRIT_YR, '위암 재발종류별' AS SMRY_STATS_NM, 10230 AS TBL_ID, 1023009 AS COL_ID,
cast(A.PT_AGE as INT) as PT_AGE, A.PT_SEX_CD, A.STATS_TRGT_VL, A.NCS,  B.WHOL_NCS, A.PT_CNT, B.WHOL_PT_CNT, 
convert(char(8),GETDATE(),112) AS STATS_WORK_YMD, '20100101' AS COLL_STRT_YMD, '20211231' AS COLL_END_YMD, GETDATE() AS CRTN_DT FROM 
(SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL, COUNT(STATS_TRGT_VL) AS NCS, COUNT(DISTINCT PT_SBST_NO) AS  PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, STATS_TRGT_VL) AS A  
INNER JOIN (SELECT HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD, COUNT(STATS_TRGT_VL) AS WHOL_NCS, COUNT(DISTINCT PT_SBST_NO) AS  WHOL_PT_CNT
FROM W1 GROUP BY HOSP_CD, CRIT_YR, PT_AGE, PT_SEX_CD) AS B  
ON A.HOSP_CD = B.HOSP_CD AND A.CRIT_YR=B.CRIT_YR AND A.PT_AGE = B.PT_AGE AND A.PT_SEX_CD = B.PT_SEX_CD
;


